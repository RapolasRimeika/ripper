# System: You are a helpful assistant. The following content is project-related information that should be used to assist in development.

# This is the project file for 'ripper'

# ---- CONFIGURATION FILES ----

# ---- BEGIN requirements.txt ----

# ---- END requirements.txt ----

# ---- PROJECT FILES ----

# ---- BEGIN ripper.py ----
import os
import sys
import shutil
import git
from settings import SYSTEM_PROMPT, CONFIG_FILES, FILE_EXTENSIONS


def collect_project_files(output_file="project_contents.txt", project_dir=None, include_hidden=False):
    """
    Collects all the files with specified extensions (.py, .txt, .json, .md) from the current directory (or a specified directory)
    and copies their contents into a single .txt file. Configuration files like `requirements.txt` are highlighted in a separate section.
    
    Parameters:
    output_file (str): The name of the output file that will store the collected project contents.
    project_dir (str): The directory of the project to collect files from. If None, uses the current directory.
    include_hidden (bool): Whether to include hidden files and directories.
    """
    current_directory = os.path.basename(project_dir) if project_dir else os.path.basename(os.getcwd())  # Get the final directory name
    
    with open(output_file, 'w') as f_out:
        f_out.write(SYSTEM_PROMPT)  # Write the system prompt from settings.py
        f_out.write(f"# This is the project file for '{current_directory}'\n\n")  # Write project file header
        
        # Section for Configuration Files
        f_out.write("# ---- CONFIGURATION FILES ----\n\n")
        for root, dirs, files in os.walk(project_dir or os.getcwd()):
            if not include_hidden:
                dirs[:] = [d for d in dirs if not d.startswith('.')]  # Exclude hidden directories
            for file_name in files:
                _, file_extension = os.path.splitext(file_name)
                if file_name in CONFIG_FILES:
                    file_path = os.path.join(root, file_name)
                    f_out.write(f"# ---- BEGIN {file_name} ----\n")
                    with open(file_path, 'r', encoding='utf-8', errors='ignore') as f_in:
                        f_out.write(f_in.read())
                    f_out.write(f"\n# ---- END {file_name} ----\n\n")

        # Section for Project Files (non-config)
        f_out.write("# ---- PROJECT FILES ----\n\n")
        for root, dirs, files in os.walk(project_dir or os.getcwd()):
            if not include_hidden:
                dirs[:] = [d for d in dirs if not d.startswith('.')]
            for file_name in files:
                _, file_extension = os.path.splitext(file_name)
                if file_extension in FILE_EXTENSIONS and file_name not in CONFIG_FILES:
                    file_path = os.path.join(root, file_name)
                    f_out.write(f"# ---- BEGIN {file_name} ----\n")
                    with open(file_path, 'r', encoding='utf-8', errors='ignore') as f_in:
                        f_out.write(f_in.read())
                    f_out.write(f"\n# ---- END {file_name} ----\n\n")

    print(f"All project files and configuration files have been copied into '{output_file}' with clear delineation markers.")


def clone_and_collect_files(github_url, output_file="project_contents.txt", include_hidden=False):
    """
    Clones a GitHub repository and uses the collect_project_files() function to collect the project files.
    
    Parameters:
    github_url (str): The URL of the GitHub repository to clone.
    output_file (str): The name of the output file that will store the collected project contents.
    include_hidden (bool): Whether to include hidden files and directories.
    """
    repo_name = github_url.split('/')[-1].replace('.git', '')
    
    if os.path.exists(repo_name):
        shutil.rmtree(repo_name)
    git.Repo.clone_from(github_url, repo_name)
    
    print(f"Cloned repository '{repo_name}' from {github_url}")
    collect_project_files(output_file, project_dir=repo_name, include_hidden=include_hidden)
    shutil.rmtree(repo_name)
    print(f"Removed the cloned repository '{repo_name}' after processing")


# Main script logic for handling flags
if __name__ == "__main__":
    include_hidden = '-a' in sys.argv  # Check for the -a flag

    if len(sys.argv) > 1 and sys.argv[1] == '-github' and len(sys.argv) > 2:
        github_url = sys.argv[2]
        clone_and_collect_files(github_url, include_hidden=include_hidden)
    else:
        collect_project_files(include_hidden=include_hidden)

# ---- END ripper.py ----

# ---- BEGIN project_contents.txt ----

# ---- END project_contents.txt ----

# ---- BEGIN README.md ----
## About

I created this tool to quickly aggregate the contents of my projects and get feedback on them from an LLM (Large Language Model). The script features a GitHub cloning function, which is especially useful when you don't want to load the entire project locally. It also avoids hidden files, like dependencies in virtual environments, by default.

### Caution

Be mindful of how you use this tool, especially when working with licensed projects. Always ensure that you're following the proper licensing terms when aggregating or sharing project files.

This is a quick tool I built to streamline my workflow and improve the way I manage my projects.


# Project File Collector

This Python script allows you to collect and aggregate the contents of specific file types from a local directory or a GitHub repository. The script supports the following features: Collects files with extensions `.py`, `.txt`, `.json`, and `.md` by default. Clones a GitHub repository and gathers the specified project files. By default, hidden files and directories are ignored, but they can be included using the `-a` flag. The output is written to a single `.txt` file that combines the contents of the collected files.

## Features

- Local file collection: Gathers project files from the current directory or a specified project directory.
- GitHub repository cloning: Clones a GitHub repository and collects the project files from it.
- Customizable inclusion of hidden files: Option to include hidden files and directories using the `-a` flag.
- Output aggregation: The collected file contents are written to a single `.txt` file. Perfect for rag tasks.

## Requirements

- Python 3.x
- GitPython package (for cloning repositories)

To install `GitPython`, run: `pip install gitpython`.

## Usage

### Collecting files from the current directory

To collect files from the current working directory and ignore hidden files, run:

```bash
python ripper.py
```

To collect files and include hidden files and directories, run:

```bash
python ripper.py -a
```

### Cloning a GitHub repository and collecting files

To clone a GitHub repository, collect project files, and ignore hidden files, run:

```bash
python ripper.py -github https://github.com/username/repo.git
```

To include hidden files from the cloned repository, run:

```bash
python ripper.py -github https://github.com/username/repo.git -a
```

## Parameters

- `output_file` (optional): The name of the file where the collected contents will be saved. Defaults to `project_contents.txt`.
- `project_dir` (optional): The directory to collect files from. If not specified, the script uses the current working directory.
- `-a` flag (optional): Include hidden files and directories.

## Example

1. **Local collection without hidden files**: `python3 ripper.py`. This will collect all `.py`, `.txt`, `.json`, and `.md` files from the current directory, excluding hidden files, and store the combined contents in `project_contents.txt`.

2. **Cloning a repository and including hidden files**: `python3 ripper.py -github https://github.com/username/repo.git -a`. This will clone the specified GitHub repository, collect all `.py`, `.txt`, `.json`, and `.md` files (including hidden files), and store them in `project_contents.txt`.

## How It Works

1. **Local Collection**: The script walks through the directory tree starting from the specified directory (or current directory if none is specified). It checks each file’s extension to see if it matches the specified types (`.py`, `.txt`, `.json`, `.md`). It writes the contents of each matching file into a single `.txt` file, separating each file with a header.

2. **GitHub Cloning**: The script clones the specified repository into a local directory. After cloning, it follows the same process as local collection to gather project files. Once the collection is done, the cloned repository is removed.

## License

This project is licensed under the MIT License.

## Getting Started

Follow these steps to set up and use the Ripper script:

### 1. Clone the Repository

Start by cloning this repository to your local machine:

```bash
git clone https://github.com/RapolasRimeika/ripper.git
cd ripper
```

### 2. Install Dependencies

Next, install the required dependencies using `pip`. You only need to install `GitPython` as it’s the only external library:

```bash
pip install -r requirements.txt
```

### 3. Create an Alias for Faster Usage

To streamline the use of this script, you can create an alias so that you can run it from anywhere without typing the full path. To do this, add the following line to your shell configuration file (e.g., `.bashrc`, `.bash_profile`, or `.zshrc` depending on your shell):

```bash
alias ripper="python /path/to/ripper/ripper.py"
```

Make sure to replace `/path/to/ripper/` with the actual path where you cloned the repository. After saving the file, apply the changes by running:

```bash
source ~/.bashrc  # or ~/.zshrc depending on your shell
```

### 4. Usage Example

Now, you can use the script from anywhere on your system by simply typing:

```bash
ripper
```

To include hidden files or clone a GitHub repository, just add the appropriate flags and parameters:

```bash
ripper -a
ripper -github https://github.com/username/repo.git
```

# ---- END README.md ----

# ---- BEGIN settings.py ----
# Define global variables for your project settings

# System prompt for LLMs
SYSTEM_PROMPT = "# System: You are a helpful assistant. The following content is project-related information that should be used to assist in development.\n\n"

# Configuration files to include
CONFIG_FILES = ['requirements.txt', 'settings.json', 'config.yaml', 'hyperparameters.json']

# File extensions to include in project collection
FILE_EXTENSIONS = ['.py', '.txt', '.json', '.md']

# Token limit for the overflow check
TOKEN_LIMIT = 8192  # Adjust according to the context window of the model you're using
# ---- END settings.py ----

